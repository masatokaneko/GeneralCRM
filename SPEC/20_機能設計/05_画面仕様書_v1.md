# 画面仕様書 v1（UI/UX Spec）

## 0. 適用範囲と前提

* 対象：Sales Cloud相当のコアCRM（Account/Contact/Lead/Opportunity/Activity/Quote/Order/Product/Pricebook/Forecast/Territory/Reports/Setup）
* 画面は **Webアプリ（PC）** を前提（モバイルは別仕様）
* UI操作はすべて **保存パイプライン（AuthZ→Validation→Automation→Audit）** を通る
* 権限（Object/Field/Record）によって **表示・編集・実行可能アクション** が変化する

---

# 1. 画面一覧（IA：Information Architecture）

## 1.1 グローバルナビ（Primary）

* Home（ホーム）
* Accounts（取引先）
* Contacts（担当者）
* Leads（見込み客）
* Opportunities（商談）
* Activities（活動：Tasks/Events）
* Quotes（見積）
* Orders（受注）
* Products（商品）
* Pricebooks（価格表）
* Forecasts（予測）
* Campaigns（施策）
* Reports（レポート）
* Dashboards（ダッシュボード）
* Setup（設定：管理者のみ）

## 1.2 共通導線（Global）

* グローバル検索（オブジェクト横断）
* 最近見た（Recently Viewed）
* お気に入り（Favorites）
* 作成（New）クイックアクション（権限に応じて候補が変わる）
* 通知センター（Approval/Workflow通知）
* ユーザメニュー（プロファイル、設定、ログアウト）

---

# 2. 共通UIコンポーネント仕様

## 2.1 一覧（List View）

### 目的

* 対象オブジェクトのレコードをフィルタ/並び替え/列選択して閲覧・操作する

### 機能要件（Must）

* 保存済みビュー（ListView）
  * ビュー名、フィルタ条件、表示列、ソート、共有範囲（Private/Shared）
* フィルタ
  * 条件はAND/OR（簡易）
  * 参照フィールド検索（Lookup Picker）
* 列
  * 表示/非表示、並び替え、列幅、固定列（先頭）
* 行アクション
  * View / Edit / Delete（権限に従う）
  * Owner変更（Transfer権限がある場合のみ）
* バルク操作
  * 一括更新（Mass Update）：許可されたフィールドのみ
  * 一括削除（Delete権限＋条件）
  * エクスポート（Export権限）
* ページング（または無限スクロール）＋件数表示

### 非表示/禁止（情報漏洩防止）

* Field Readable=false のフィールドは列に出せない
* 参照不可フィールドでフィルタ/ソートできない
* レコード集合は必ず RecordAccess>=Read のみ

---

## 2.2 詳細（Record Page）

### 共通構成（Must）

* ヘッダ：主要フィールド（Name/Status/Owner/更新日時）
* アクションバー：Edit/Delete/Clone/Share/Change Owner 等（権限で出し分け）
* タブ：
  * Details（詳細）
  * Related（関連）
  * Activity（タイムライン）
  * Files（添付）
  * History（履歴：監査閲覧権限がある場合）
* 右ペイン（任意）：次アクション、ステージ進捗、重要アラート（Validation/Approval）

### 編集UX（Must）

* 編集は
  * (A) モーダル編集 もしくは
  * (B) 編集ページ遷移
    のどちらでも可。ただし項目数が多い場合は(B)を推奨。
* インライン編集は Field Editable=true のみ

---

## 2.3 検索（Global Search）

### 機能要件（Must）

* キーワード検索：Name系 +（任意）全文
* オブジェクト別タブで絞り込み
* 検索結果は RecordAccess>=Read のみ
* 表示フィールドは Field Permissionでマスク
* ハイライト表示（任意）

### 重要制約

* 見えない項目を根拠に検索ヒットしても、結果に表示しない（情報漏洩）
* 参照不可オブジェクトは検索対象から除外

---

## 2.4 通知（Notifications）

* Workflow/Approval/期限切れ等の通知を一覧で表示
* 既読/未読、フィルタ（自分宛/自分起点）

---

# 3. オブジェクト別画面仕様

## 3.1 Home（ホーム）

### 目的

* ユーザの当日業務を集約

### ウィジェット（Must）

* 今日のタスク（期限/優先度）
* 近日の予定（Event）
* パイプラインサマリ（自分の商談：ステージ別金額）
* 最近見たレコード
* 承認待ち（自分がApprover의 WorkItem）

### 設定（Should）

* ウィジェットの表示/非表示、並び替え（個人設定）

---

## 3.2 Accounts（取引先）

### 画面

* 一覧（List View）
* 詳細（Record Page）
* 作成/編集（Form）

### 詳細ページ：表示要件（Must）

* Details：Name, Type, Industry, Parent, Owner, Status, 住所等
* Related：
  * Contacts（担当者）
  * Opportunities（商談）
  * Activities（活動）
  * Files（添付）
  * Team（Account Team）
  * Territory Assignments（割当）
* Activity：関連するTask/Eventのタイムライン

### アクション（Must）

* New Contact（取引先配下）
* New Opportunity（取引先配下）
* Add Team Member（権限）
* Change Owner（Transfer権限）
* Share（ManageSharing権限）

---

## 3.3 Contacts（担当者）

### 詳細ページ：Must

* Details：氏名、所属Account、役職、連絡先、Owner、Status
* Related：
  * Opportunities（OpportunityContactRole経由：どの商談に関与）
  * Activities（Whoとして紐付いたもの）
  * Campaigns（CampaignMember）
  * Files
* アクション：
  * Log Activity（Task/Event作成）
  * Edit / Delete（権限）

---

## 3.4 Leads（見込み客）

### 一覧：Must

* ステータス別（New/Working/Nurturing/Qualified/Disqualified）
* 重複疑いフラグでフィルタ可能

### 詳細：Must

* Details：Company, Name, Contact info, Status, LeadSource, Owner
* Activity：Leadに紐付く活動（Who=Lead）

### アクション：Must

* Convert（コンバート）
  * 実行可能条件：Lead.Status=Qualified、Convert権限
  * 変換ダイアログ：
    * Account：新規/既存選択（検索付）
    * Contact：新規/既存選択
    * Opportunity：作成する/しない（作成時はName/CloseDate/Stage等）
  * 成功時：作成/紐付け先へ遷移、ConvertLogへのリンク（監査権限）

### 例外表示：Must

* 重複検知でブロックされた場合：
  * 候補レコード（Account/Contact）を提示し、既存選択へ誘導

---

## 3.5 Opportunities（商談）

### 一覧：Must

* My Pipeline（自分のOwner/Team対象）
* Closing this Month（CloseDate）
* By Stage（ステージ別）
* Forecast Category（予測カテゴリ別）

### 詳細ページ：Must（構成）

* Header：Name, Account, Stage, Amount, CloseDate, Owner
* Stage Path（上部の工程バー）
  * ステージ変更はここから可能（Update権限）
  * 遷移時に RequiredFields 未充足ならエラー表示（フィールドに誘導）
* 右ペイン（Must）
  * NextStep / NextActionDate
  * Alerts：承認中、期限切れ見積、必須未入力

### タブ：Related（Must）

* Contact Roles（商談関与者）
* Products（OpportunityLineItems）
* Quotes（見積）
* Orders（受注）
* Activities（What=Opportunity）
* Files
* Team（Opportunity Team）
* Sharing（共有：管理者/権限者のみ）

### アクション：Must

* Add Contact Role（Contact検索→Role/Influence/Stance）
* Add Products（価格表選択→商品追加）
  * Pricebook未設定なら「価格表選択」を強制
  * PricebookEntry整合違反は保存不可
* New Quote（商談配下）
* Create Order（商談起点）
* Close Won / Close Lost
  * Close LostはLostReason必須

### 承認連携：Must

* 値引き等で承認が必要な場合：
  * “Submit for Approval” ボタンを表示
  * Submitted中はロックフィールドを編集不可表示

---

## 3.6 Activities（Task/Event）

### 一覧：Must

* My Tasks（期限/優先度）
* My Events（カレンダー/リスト）

### 作成：Must

* Task作成フォーム
  * Subject, Status, Priority, DueDate
  * Who（Lead/Contact検索）
  * What（Account/Opportunity等検索）
* Event作成フォーム
  * Subject, Start/End, Location
  * Who/What

### 表示制約：Must

* Whatが見えない場合の表示ポリシー
  * **標準（推奨）**：件名のみ表示、本文/詳細はマスク（情報漏洩対策）
  * 管理者は完全表示可（特権）

---

## 3.7 Quotes（見積）

### 一覧：Must

* My Quotes（Owner）
* Quotes by Status（Draft/Presented/Accepted/Expired）

### 詳細：Must

* Header：Name, Opportunity, Status, IsPrimary, ExpirationDate, GrandTotal
* Related：
  * Line Items（QuoteLineItem）
  * Files（見積書PDF等）
  * Approval（必要なら）
* アクション：
  * Present（Draft→Presented）
  * Accept / Reject（Presented→Accepted/Rejected）
  * Mark as Primary（IsPrimary=true）
  * Generate PDF（Should：テンプレート別出力）

### 制約：Must

* IsPrimaryは商談内で1つ（違反時エラー）
* ExpirationDate超過はバッチでExpiredに（Scheduled Automation）

---

## 3.8 Orders（受注）

### 一覧：Must

* Orders by Status（Draft/Activated/Fulfilled/Cancelled）

### 詳細：Must

* Header：Account, Opportunity(optional), Status, EffectiveDate, TotalAmount
* Related：OrderItems、Files
* アクション：
  * Activate（Draft→Activated）
  * Fulfill（Activated→Fulfilled）
  * Cancel（Draft/Activated→Cancelled）

### 制約：Must

* Activated以降の変更制限（ロック表示）
  * 変更しようとすると承認orエラー（自動化仕様に従う）

---

## 3.9 Products / Pricebooks（商品・価格表）

### Products：Must

* 一覧：IsActiveフィルタ
* 詳細：Name, Code, Family, IsActive
* アクション：無効化（IsActive=false）

### Pricebooks：Must

* 一覧：標準/カスタム
* 詳細：
  * PricebookEntry一覧（Product, UnitPrice, IsActive）
  * 新規追加（Product検索→UnitPrice）
* 制約：
  * (PricebookId, ProductId) 一意（違反時エラー）

---

## 3.10 Forecasts（予測）

### 一覧：Must

* 期間選択（Month/Quarter）
* 自分の予測（Draft/Submitted/Finalized）
* チームの予測（Manager権限）

### 詳細：Must

* サマリ：BaseAmount / Adjustment / Final
* カテゴリ別内訳（ForecastItem）
* 変更履歴（ForecastAdjustment）
* アクション：
  * Submit（Draft→Submitted）
  * Adjust（Managerのみ、Adjustment追加）
  * Finalize（Manager/特権）

### 制約：Must

* 調整は追記のみ（上書き禁止）
* 提出済みの取り扱い（P1：Baseは自動追随、Adjustmentは保持）を画面上で明示

---

## 3.11 Campaigns（施策）

### Must（Should扱いでも可だが本スコープに含める）

* Campaign CRUD、Status管理
* CampaignMember（Lead/Contact）登録
* 反応ステータス更新

---

# 4. Setup（設定画面：Admin）

## 4.1 設定トップ（Must）

* Object Manager（オブジェクト/項目/レイアウト）
* Permissions（Profile/PermissionSet/Role/Group）
* Sharing（OWD/ShareRule/Team/Territory）
* Automation（Validation/Workflow/Approval/Scheduled）
* Reports（レポート定義・フォルダ権限）
* Audit（監査ログ、実行ログ）

---

## 4.2 Object Manager（Must）

* オブジェクト一覧（標準＋カスタム）
* オブジェクト設定：
  * フィールド定義（FieldDefinition）
  * ページレイアウト（表示順/必須/セクション/関連リスト）
  * リストビュー定義
  * 検索レイアウト（検索結果に出す列）

---

## 4.3 Permissions（Must）

* Profile（基本権限）
  * ObjectPerm（CRUD）
  * FieldPerm（R/W）
  * SystemPerm
* PermissionSet（追加）
* Role Hierarchy（ツリー編集）
* Groups / Queues（メンバー管理）

---

## 4.4 Sharing（Must）

* OWD設定（オブジェクト別）
* ShareRule管理（条件式ビルダー＋対象＋アクセス）
* Team Role定義（TeamRole→Access）
* Territory
  * TerritoryModel（Planning/Active）
  * Territory階層編集
  * ルール定義（Criteria）
  * シミュレーション（割当結果）
  * 有効化（Active切替、ShareModelVersion切替）

---

## 4.5 Automation（Must）

* Validation Rule管理
  * 条件式、エラー、対象フィールド
* Workflow Rule管理
  * Trigger、条件、Actions、Priority
* Approval管理
  * EntryCriteria、Stages、Approver、ロックフィールド
* Scheduled Jobs
  * スケジュール、対象、アクション
* 実行ログ閲覧（AutomationRunLog）

---

# 5. レポート/ダッシュボード UI

## 5.1 Reports（Must）

* レポート作成（ビルダー）
  * 対象オブジェクト選択（主＋関連）
  * フィルタ
  * グループ化（行/列）
  * 集計（SUM/COUNT/AVG）
  * 可視項目のみ選択可能（Field Permission）
* 実行結果は RecordAccess に従う（INV-SH1）
* フォルダ権限（閲覧/編集）

## 5.2 Dashboards（Must）

* 複数レポート（チャート/テーブル）を配置
* 実行ユーザ権限で見えるデータのみ表示
* 自動更新（スケジュール）

---

# 6. 画面共通：エラー/ガイダンス/監査

## 6.1 エラー表示（Must）

* Validationエラー：フィールド単位に表示＋画面上部に要約
* 権限エラー：操作不可の理由を表示（ただし内部構造は出しすぎない）
* 競合エラー：再読み込みと差分提示（楽観ロック）

## 6.2 監査表示（Must）

* Historyタブ：
  * フィールド履歴（Hist=trueの項目）
  * 重要イベントログ（Convert/Stage/Owner/PrimaryQuote/Approval 等）
* Adminのみ：AutomationRunLogを追跡できる

---

# 7. 受入条件（UI）

最低限, 以下が成立していること：

1. 一覧/詳細/検索/レポートの可視性が一致（INV-SH1）
2. ステージ遷移時に必須未入力ならUIが正しく誘導し保存不可
3. コンバート・主要見積・承認など重要操作がUIから完結し、監査へ残る
4. Field Permissionで列/フォーム/検索/レポートがマスクされる
5. Setupでオブジェクト・権限・共有・自動化が設定可能
