# 24_ロジック・ビジネスルール (Logic & Business Rules)

## 1. リード変換ロジック (Lead Conversion)
リードが「評価済み (Qualified)」となった際、以下の処理を行う。

*   **取引先の作成/紐付け**: 指標に基づき、既存の取引先があれば紐付け、なければ新規作成。
*   **連絡先の作成/紐付け**: リードの氏名・メールアドレスに基づき新規作成。
*   **商談の作成（オプション）**: ユーザーの選択により新規商談を作成。金額や完了予定日の初期値をセット。
*   **データ引き継ぎ**: リードの住所やカスタムフィールドの値を、取引先・連絡先へマッピング。

## 2. 商談進捗ルール
*   **フェーズと確率の連動**: フェーズ（商談開始、提案中、最終交渉など）ごとにデフォルトの成約確率 (%) を保持。
*   **完了予定日のチェック**: 過去の完了予定日が設定されている場合、警告または更新を促す。
*   **成約/失注時**: 完了理由の入力を必須化。

## 3. バリデーションルール (Validation)
*   **メールアドレス形式**: 有効な形式であること。
*   **商談金額**: マイナス値の入力を禁止。
*   **電話番号**: フォーマットチェック（国コード対応はフェーズ2）。

## 4. 自動化（Flow相当）
*   **所有者の自動割り当て**: 地域や企業規模に基づき、リードの所有者を自動で振り分ける（フェーズ2）。
*   **通知**: 大規模商談（例：1,000万円以上）が作成された際、マネージャーにSlack/メール通知。
*   **活動期限アラート**: 期限が過ぎたToDoがある場合、ホーム画面の「要対応」リストに表示。

## 5. 計算ロジック
*   **売上予測 (Forecasting)**: `商談金額 × 成約確率` の合計値を月別/クォーター別に算出。
*   **滞留期間**: 各フェーズに何日間留まっているかを自動集計。
