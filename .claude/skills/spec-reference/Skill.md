---
name: spec-reference
description: CRM仕様書の参照、検索、概要把握。「SPEC」「仕様書」「要件」「ドキュメント」「設計書」「リファレンス」に関する質問で呼び出される。
---

# CRM仕様書参照スキル

SPEC仕様書の構造と参照方法をガイドします。

## いつ使用するか

- CRM仕様書の内容を確認したいとき
- 特定の機能の要件や設計を調べたいとき
- 「SPECを確認して」「仕様書を見て」と言われたとき
- ドメイン用語の定義を確認したいとき
- 実装フェーズや優先度を確認したいとき

## 仕様書のディレクトリ構造

```
SPEC/
├── 10_要件定義/
│   ├── 01_用語集_v1.md              # ドメイン用語の正準定義（最重要）
│   ├── 02_スコープ_同等性マトリクス_v1.md  # MoSCoW優先度、フェーズ計画
│   ├── 03_業務プロセス定義_状態遷移_v1.md  # 各オブジェクトの業務フロー
│   ├── 11_ビジネス要件.md
│   ├── 12_機能要件.md
│   ├── 13_非機能要件.md
│   ├── 14_要件定義書_包括_v1.md
│   ├── 15_ユースケース一覧_業務フロー_v1.md
│   └── 16_トレーサビリティ表_v1.md
├── 20_機能設計/
│   ├── 01_ドメインERD_不変条件_v1.md     # エンティティ設計、70+の不変条件（必読）
│   ├── 02_データ辞書_v1.md            # 全エンティティの項目定義
│   ├── 03_権限_共有設計_v1.md         # 3層権限モデル、共有ルール
│   ├── 04_自動化設計_v1.md            # 保存パイプライン、バリデーション
│   ├── 05_画面仕様書_v1.md
│   ├── 25_物理DB設計_v1.md            # PostgreSQL物理スキーマ
│   ├── 26_アプリケーションアーキテクチャ設計_v1.md
│   ├── 27_Core内部モジュール設計_v1.md
│   ├── 28_権限評価_共有_詳細決定表_v1.md
│   ├── 29_バリデーション_ワークフロー_DSL仕様_v1.md
│   ├── 30_レポート_クエリエンジン仕様_v1.md
│   └── 31_エッジケース集_v1.md
└── 30_インターフェース/
    ├── 31_API定義_v1.md              # REST API仕様
    ├── 32_サービス境界仕様書_v1.md     # サービス間責務と依存
    └── 33_イベント仕様書_v1.md         # ドメインイベント定義
```

## 参照の優先順序

1. **用語確認**: `01_用語集_v1.md` - 正準用語、同義語、禁止語
2. **不変条件確認**: `01_ドメインERD_不変条件_v1.md` - INV-xxx形式で定義
3. **スコープ確認**: `02_スコープ_同等性マトリクス_v1.md` - Phase 1/2/3、MoSCoW
4. **詳細設計**: 対象機能に応じた設計書

## 主要ファイルと重要度

| ファイル | 行数 | 重要度 | 用途 |
|---------|------|-------|------|
| 25_物理DB設計_v1.md | 1,026 | 最高 | DB実装の基準 |
| 01_ドメインERD_不変条件_v1.md | 1,009 | 最高 | システム全体の論理設計 |
| 03_業務プロセス定義_状態遷移_v1.md | 745 | 高 | ビジネスロジック定義 |
| 02_データ辞書_v1.md | 691 | 高 | フィールド詳細定義 |
| 15_ユースケース一覧_業務フロー_v1.md | 545 | 高 | ユーザーストーリー |
| 31_API定義_v1.md | 483 | 高 | REST API仕様 |

## 不変条件の概要（INV-xxx）

### テナント・セキュリティ
- **INV-T1**: マルチテナント隔離（全クエリでtenant_id必須）
- **INV-T2**: Role階層の非循環性（最大10レベル）
- **INV-T3**: 権限継承の整合性

### 営業ドメイン
- **INV-A1**: Contact.account_id NOT NULL
- **INV-A2**: Account階層の非循環性（最大5レベル）
- **INV-O1〜O4**: 商談の整合性（Account必須、ステージ、完了状態、日付）
- **INV-L1〜L2**: リード変換の原子性、不適格整合性

### 商品・価格
- **INV-P1**: 価格表整合性
- **INV-LI1〜LI3**: 明細の価格表一致、金額計算
- **INV-Q1〜Q3**: 見積のPrimary唯一性、有効期限、受注変換

### 共有
- **INV-SH1〜SH4**: 共有評価の一貫性

## 実装フェーズ

- **Phase 1 (Must)**: コアCRUD、基本セキュリティ、監査ログ
- **Phase 2 (Should)**: 高度な自動化、GraphQL、予測
- **Phase 3 (Could)**: AI機能、テリトリ管理、高度なCPQ

## よく使うコマンド

```bash
# 用語集で特定用語を検索
grep -n "商談" SPEC/10_要件定義/01_用語集_v1.md

# 不変条件を検索
grep -n "INV-" SPEC/20_機能設計/01_ドメインERD_不変条件_v1.md

# 特定エンティティの設計を検索
grep -rn "Opportunity" SPEC/
```

## 注意事項

- 不明な用語は必ず用語集で確認する
- 実装時は対応する不変条件を確認する
- 優先度の判断はスコープマトリクスを参照する
